<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Handbook Auth</title>
</head>
<body>
<h1>Регистрация</h1>
<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<input id="password" placeholder="Password" type="password">
<button onclick="register()">Register</button>

<h1>Логин</h1>
<input id="loginEmail" placeholder="Email">
<input id="loginPassword" placeholder="Password" type="password">
<button onclick="login()">Login</button>

<h2>Профиль</h2>
<pre id="profile"></pre>

<script>
async function register() {
    const res = await fetch('/api/register', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        })
    });
    alert(res.status === 201 ? 'Registered!' : 'Failed');
}

async function login() {
    const res = await fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value
        })
    });
    const data = await res.json();
    localStorage.setItem('token', data.token);
    getProfile();
}

async function getProfile() {
    const res = await fetch('/api/profile', {
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
    });
    const data = await res.json();
    document.getElementById('profile').innerText = JSON.stringify(data, null, 2);
}
</script>
</body>
</html>
